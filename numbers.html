<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>تعلم الأرقام</title>
  <link rel="stylesheet" href="s.css" />
  <style>
    /* شاشة المقدمة */
    #intro-screen {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #fef6e4, #e0f7fa);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 2.2em;
      font-weight: bold;
      color: #333;
      z-index: 20000;
      animation: fadeIn 1s ease-in-out;
    }

    /* حركة الدخول والخروج */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }

    /* --- CSS النافذة المنبثقة تغطي الشاشة بالكامل --- */
    #game-popup {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(2px);
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }

    #game-popup.show {
      display: flex;
    }

    #game-popup .popup-box {
      background: white;
      width: 90vw;
      max-width: 900px;
      aspect-ratio: 16/10;
      border-radius: 1.8em;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: inset 0 0 15px rgba(0,0,0,0.05);
    }

    #game-popup iframe {
      flex: 1;
      width: 100%;
      height: 100%;
      border: none;
    }
  </style>
</head>
<body>

  <!-- شاشة المقدمة -->
  <div id="intro-screen">
    🌟 مرحبًا بك في رحلة تعلم الأرقام 🌟
    <audio id="intro-audio" src="assets/welcome.mp3"></audio>
  </div>

  <!-- زر الرئيسية -->
  <div class="top-bar">
    <a href="index.html">
      <button class="home-button">🏠 الرئيسية</button>
    </a>
  </div>

  <div class="main-wrapper">
    <!-- زر التالي -->
    <button class="nav-button next" onclick="nextLetter()">⮞</button>

    <!-- الصورة + زر الاستماع -->
    <div class="letter-card">
      <div class="image-wrapper">
        <img id="image" src="" alt="صورة الرقم" />
      </div>
      <button class="listen-button" onclick="playSound()">🔊 اضغط للاستماع</button>
      <audio id="audio"></audio>
    </div>

    <!-- زر السابق -->
    <button class="nav-button prev" onclick="prevLetter()">⮜</button>
  </div>

  <!-- نافذة اللعبة -->
  <div id="game-popup">
    <div class="popup-box">
      <iframe id="game-frame" src=""></iframe>
      <div class="popup-buttons" id="popup-buttons"></div>
    </div>
  </div>

<script>
let current = 0;
const letters = [
  { image: "images/N0.png", sound: "assets/N0.mp3" },
  { image: "images/N1.png", sound: "assets/N1.mp3" },
  { image: "images/N2.png", sound: "assets/N2.mp3" },
  { image: "images/N3.png", sound: "assets/N3.mp3" },
  { image: "images/N4.png", sound: "assets/N4.mp3" },
  { image: "images/N5.png", sound: "assets/N5.mp3" },
  { image: "images/N6.png", sound: "assets/N6.mp3" },
  { image: "images/N7.png", sound: "assets/N7.mp3" },
  { image: "images/N8.png", sound: "assets/N8.mp3" },
  { image: "images/N9.png", sound: "assets/N9.mp3" },
  { image: "images/N10.png", sound: "assets/N10.mp3" },
];

// تشغيل المقدمة
window.onload = () => {
  const introAudio = document.getElementById("intro-audio");
  introAudio.play().catch(() => {}); // تجاهل مشاكل التشغيل التلقائي
  setTimeout(() => {
    const intro = document.getElementById("intro-screen");
    intro.style.animation = "fadeOut 1s ease-in-out";
    setTimeout(() => {
      intro.style.display = "none";
      update();
    }, 1000);
  }, 4000);
};

function update() {
  document.getElementById("image").src = letters[current].image;
  document.getElementById("audio").src = letters[current].sound;
}

function nextLetter() {
  current++;
  if (current >= letters.length) current = letters.length - 1;
  update();

  if (current === 4 || current === 8) {
    openGamePopup();
  } else if (current === letters.length - 1) {
    setTimeout(() => {
      openGamePopup();
    }, 10000);
  }
}

function prevLetter() {
  current--;
  if (current < 0) current = 0;
  update();
}

function playSound() {
  const audio = document.getElementById("audio");
  audio.pause();
  audio.currentTime = 0;
  audio.play();
}

function openGamePopup() {
  document.getElementById("audio").pause();

  let group;
  if (current === 4) group = 1;
  else if (current === 8) group = 2;
  else if (current === letters.length - 1) group = 3;
  else group = 0;

  document.getElementById("game-frame").src = `gamess.html?group=${group}`;

  const popupBtns = document.getElementById("popup-buttons");
  popupBtns.innerHTML = "";

  if (group === 1 || group === 2) {
    const contBtn = document.createElement("button");
    contBtn.className = "continue-btn";
    contBtn.textContent = "استمر التعلم";
    contBtn.onclick = closeGamePopup;
    popupBtns.appendChild(contBtn);
  } else if (group === 3) {
    const contBtn = document.createElement("button");
    contBtn.className = "continue-btn";
    contBtn.textContent = "استمر في اللعب";
    contBtn.onclick = () => {
      const audioEnd = new Audio("assets/end.mp3");
      audioEnd.play();
      closeGamePopup();
    };
    popupBtns.appendChild(contBtn);
  }

  document.getElementById("game-popup").classList.add("show");
  document.body.style.overflow = "hidden";
}

function closeGamePopup() {
  document.getElementById("game-popup").classList.remove("show");
  document.getElementById("game-frame").src = "";
  document.body.style.overflow = "";
}
</script>

</body>
</html>
